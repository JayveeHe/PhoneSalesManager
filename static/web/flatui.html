<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <title>手机销售管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="css/vendor/bootstrap.min.css" rel="stylesheet">

    <!-- Loading Flat UI -->
    <link href="css/flat-ui.css" rel="stylesheet">
    <link href="css/jquery.dataTables.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/favicon.ico">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/vendor/html5shiv.js"></script>
      <script src="js/vendor/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery (necessary for Flat UI's JavaScript plugins) -->
    <script src="js/vendor/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/vendor/video.js"></script>
    <script src="js/flat-ui.min.js"></script>

    <!-- datatables-->
    <script src="js/jquery.dataTables.min.js"></script>


    <!-- 获取表格数据 -->
    <script>
        $(document).ready(function () {
            loadDataBase('RemainsRecords');
        });

        //alert('START');
        // $(document).ready(function () {
        //     loadDataBase('PhoneRemains');
        // });
        var tableObj;
        var dataSet = [];
        var jsondata;
        var theTypeIs;
        function loadDataBase(tablename) {
            $.get('/data/' + tablename, null, function (data, status) {
                if (status == "success") {
                    //document.getElementById("tables").innerHTML = xmlhttp.responseText;
                    //var dataSet = [];
                    jsondata = eval(data);
                    theTypeIs = Object.keys(jsondata[0]);
                    for (var i = 0; i < jsondata.length; i++) {
                        var data_temp = [];
                        for (var j = 0; j < theTypeIs.length; j++) {
                            data_temp[j] = jsondata[i][theTypeIs[j]];
                        }
                        data_temp[theTypeIs.length] = [];
                        dataSet[i] = (data_temp);
                    }
                    console.log(dataSet);
                    if (!tableObj) {
                        tableObj = $("#data_tables").dataTable({
                            "data": [],
                            "fnCreatedRow": function (nRow, aData, iDataIndex) {
                                $('td:eq(' + (theTypeIs.length) + ')', nRow)
                                        .append("<button style ='float:center' class='btn btn-primary' data-toggle='modal' data-target='#Remains_Update_Modal' onclick=rowUpdate(" + iDataIndex + ")>修改</button>");
                                $('td:eq(' + (theTypeIs.length) + ')', nRow)
                                        .append("<button style ='float:center' class='btn btn-danger' onclick=rowclick(" + iDataIndex + ")>删除</button>");
                            },
                            "columns": [
                                { "title": "名称" },
                                { "title": "类型" },
                                { "title": "分店号" },
                                { "title": "ID" },
                                { "title": "剩余量"},
                                {"title": "操作"}
                            ]
                        });
                        tableObj.fnAddData(dataSet);
                    }
                    else {
                        tableObj.fnClearTable();
                        tableObj.fnAddData(dataSet);
                        //console.log();
                    }
                }
            });
        }

        function rowUpdate(data_index) {
            var msgText = "";
            var updateTitles=["名称","类型","分店号","ID","剩余量"];
            theTypeIs = Object.keys(jsondata[0]);
            for (var j = 0; j < theTypeIs.length; j++) {
                var inputHtml = "<input class=\"form-control\" type=\"text\" placeholder=\"Inactive\" value=" + jsondata[data_index][theTypeIs[j]] + "></input>";
                msgText += "<span>" + updateTitles[j] + "</span>" + inputHtml;
            }
            $("#modal_text").html("修改为：<br>" + msgText);
        }
    </script>

</head>
<body>
<div class="container">
    <div class="row">
        <nav class="nav navbar-inverse" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#navbar-collapse-01">
                    <span class="sr-only">Toggle navigation</span>
                </button>
                <a class="navbar-brand" href="#">库存管理</a>
            </div>
            <div class="collapse navbar-collapse" id="navbar-collapse-01">
                <ul class="nav navbar-nav">
                    <li><a class="btn-link" onclick="loadDataBase('RemainsRecords')">销售记录</a></li>
                    <li><a href="#fakelink">库存信息</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>
    </div>
    <div class="row">
        <div class="box col-md-10">
            <table class="display" id="data_tables" style="width: 100%"></table>
        </div>
        <div class="box col-md-2 palette palette-clouds">
            <div class="box" style="margin: 20px;align-content: center">
                <button class="btn btn-info" style="width: 100%;margin: 5px" data-toggle="modal" data-target="#update_Modal">
                    增加基本信息
                </button>
                <button class="btn btn-danger" style="width: 100%;margin: 5px">删除基本信息</button>
                <button class="btn btn-primary" style="width: 100%;margin: 5px">添加销售记录</button>
                <button class="btn btn-primary" style="width: 100%;margin: 5px">添加库存信息</button>
            </div>
        </div>
    </div>
    <!-- /.container -->

</div>

<!-- 模态框（Modal） -->
<div class="modal fade" id="Remains_Update_Modal" tabindex="-1" role="dialog"
      aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    注意！
                </h4>
            </div>
            <div class="modal-body" id="modal_text">
                在这里添加一些文本
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">关闭
                </button>
                <button type="button" class="btn btn-primary">
                    提交更改
                </button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal -->
</div>

</body>
</html>
