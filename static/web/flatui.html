<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <title>手机销售管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="css/vendor/bootstrap.min.css" rel="stylesheet">

    <!-- Loading Flat UI -->
    <link href="css/flat-ui.css" rel="stylesheet">
    <link href="css/jquery.dataTables.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/favicon.ico">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/vendor/html5shiv.js"></script>
      <script src="js/vendor/respond.min.js"></script>
    <![endif]-->
    <!-- jQuery (necessary for Flat UI's JavaScript plugins) -->
    <script src="js/vendor/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/vendor/video.js"></script>
    <script src="js/flat-ui.min.js"></script>

    <!-- datatables-->
    <script src="js/jquery.dataTables.min.js"></script>


    <!-- 获取表格数据 -->
    <script>
        $(document).ready(function () {
            loadRemainsData('RemainsRecords');
        });

        //alert('START');
        // $(document).ready(function () {
        //     loadRemainsData('PhoneRemains');
        // });
        var remains_tableObj;
        var sales_tableObj;
        var remains_dataSet;
        var sales_dataSet;
        var jsondata;
        var theTypeIs;
        function loadRemainsData(tablename) {
            $("#sales_div").hide();
            $("#remains_div").show();
            remains_dataSet = [];
            $.get('/data/' + tablename, null, function (data, status) {
                if (status == "success") {
                    //document.getElementById("tables").innerHTML = xmlhttp.responseText;
                    //var dataSet = [];
                    jsondata = eval(data);
                    theTypeIs = Object.keys(jsondata[0]);
                    for (var i = 0; i < jsondata.length; i++) {
                        var data_temp = [];
                        data_temp[0] = jsondata[i]['item_name'];
                        data_temp[1] = jsondata[i]['item_type'];
                        data_temp[2] = jsondata[i]['sale_pos'];
                        data_temp[3] = jsondata[i]['remains'];
                        //for (var j = 0; j < theTypeIs.length; j++) {
                        //    data_temp[j] = jsondata[i][theTypeIs[j]];
                        //}
                        data_temp[4] = [];
                        remains_dataSet[i] = (data_temp);
                    }
                    console.log(remains_dataSet);
                    if (!remains_tableObj) {
                        remains_tableObj = $("#remains_tables").dataTable({
                            "data": [],
                            "fnCreatedRow": function (nRow, aData, iDataIndex) {
                                $('td:eq(' + (4) + ')', nRow)
                                        .append("<button style ='float:center' class='btn btn-primary' data-toggle='modal' data-target='#Remains_Update_Modal' onclick=remainsUpdate(" + iDataIndex + ")>修改</button>");
                                $('td:eq(' + (4) + ')', nRow)
                                        .append("<button style ='float:center' class='btn btn-danger' onclick=rowclick(" + iDataIndex + ")>删除</button>");
                            },
                            "columns": [
                                { "title": "名称" },
                                { "title": "类型" },
                                { "title": "分店号" },
                                { "title": "剩余量"},
                                {"title": "操作"}
                            ]
                        });
                        remains_tableObj.fnAddData(remains_dataSet);
                    }
                    else {
                        remains_tableObj.fnClearTable();
                        remains_tableObj.fnAddData(remains_dataSet);
                        //console.log();
                    }
                }
            });
        }

        function loadSalesData(tablename) {
            $("#sales_div").show();
            $("#remains_div").hide();
            sales_dataSet = [];
            $.get('/data/' + tablename, null, function (data, status) {
                if (status == "success") {
                    //document.getElementById("tables").innerHTML = xmlhttp.responseText;
                    //var dataSet = [];
                    jsondata = eval(data);
                    theTypeIs = Object.keys(jsondata[0]);
                    for (var i = 0; i < jsondata.length; i++) {
                        var data_temp = [];
                        data_temp[0] = jsondata[i]['item_name'];
                        data_temp[1] = jsondata[i]['item_type'];
                        data_temp[2] = jsondata[i]['price'];
                        data_temp[3] = jsondata[i]['sale_pos'];
                        data_temp[4] = jsondata[i]['sale_time'];
                        //for (var j = 0; j < theTypeIs.length; j++) {
                        //    data_temp[j] = jsondata[i][theTypeIs[j]];
                        //}
                        data_temp[5] = [];
                        sales_dataSet[i] = (data_temp);
                    }
                    console.log(sales_dataSet);
                    if (!sales_tableObj) {
                        sales_tableObj = $("#sales_tables").dataTable({
                            "data": [],
                            "fnCreatedRow": function (nRow, aData, iDataIndex) {
                                $('td:eq(' + (5) + ')', nRow)
                                        .append("<button style ='float:center' class='btn btn-primary' data-toggle='modal' data-target='#Remains_Update_Modal' onclick=salesUpdate(" + iDataIndex + ")>修改</button>");
                                $('td:eq(' + (5) + ')', nRow)
                                        .append("<button style ='float:center' class='btn btn-danger' onclick=rowclick(" + iDataIndex + ")>删除</button>");
                            },
                            "columns": [
                                { "title": "名称" },
                                { "title": "类型" },
                                { "title": "售价" },
                                { "title": "分店号"},
                                { "title": "销售时间" },
                                { "title": "操作"}
                            ]
                        });
                        sales_tableObj.fnAddData(sales_dataSet);
                    }
                    else {
                        sales_tableObj.fnClearTable();
                        sales_tableObj.fnAddData(sales_dataSet);
                        //console.log();
                    }
                }
            });
        }

        function remainsUpdate(data_index) {
            var msgText = "";
            var updateTitles = ["名称", "类型", "分店号", "剩余量"];
            var ids = ["item_name",'item_type','sale_pos','remains'];
            theTypeIs = Object.keys(jsondata[0]);
            for (var j = 0; j < ids.length; j++) {
                var inputHtml = "<input class=\"form-control\" type=\"text\" placeholder=\"Inactive\" value=" + remains_dataSet[data_index][j] + "></input>";
                msgText += "<span>" + updateTitles[j] + "</span>" + inputHtml;
            }
            $("#modal_text").html("修改为：<br>" + msgText);
        }

        function salesUpdate(data_index) {
            var msgText = "";
            var updateTitles = [ "名称", "类型", "售价" , "分店号","销售时间"];
            var ids = ["item_name",'item_type','price','sale_pos','sale_time'];
            theTypeIs = Object.keys(jsondata[0]);
            for (var j = 0; j < ids.length; j++) {
                var inputHtml = "<input class=\"form-control\" type=\"text\" placeholder=\"Inactive\" value=" + sales_dataSet[data_index][j] + "></input>";
                msgText += "<span>" + updateTitles[j] + "</span>" + inputHtml;
            }
            $("#modal_text").html("修改为：<br>" + msgText);
            $("#btn_submit").click(function(){

            })
        }
    </script>

</head>
<body>
<div class="container">
    <div class="row">
        <nav class="nav navbar-inverse" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#navbar-collapse-01">
                    <span class="sr-only">Toggle navigation</span>
                </button>
                <a class="navbar-brand" href="#">库存管理</a>
            </div>
            <div class="collapse navbar-collapse" id="navbar-collapse-01">
                <ul class="nav navbar-nav">
                    <li><a class="btn-link" onclick="loadSalesData('SalesRecords')">销售记录</a></li>
                    <li><a class="btn-link" onclick="loadRemainsData('RemainsRecords')">库存信息</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </nav>
    </div>
    <div class="row">
        <div class="box col-md-10">
            <div id="remains_div">
                <table class="display" id="remains_tables" style="width: 100%"></table>
            </div>
            <div id="sales_div">
                <table class="display" id="sales_tables" style="width: 100%"></table>
            </div>
        </div>
        <div class="box col-md-2 palette palette-clouds">
            <div class="box" style="margin: 20px;align-content: center">
                <button class="btn btn-info" style="width: 100%;margin: 5px" data-toggle="modal"
                        data-target="#update_Modal">
                    增加基本信息
                </button>
                <button class="btn btn-danger" style="width: 100%;margin: 5px">删除基本信息</button>
                <button class="btn btn-primary" style="width: 100%;margin: 5px">添加销售记录</button>
                <button class="btn btn-primary" style="width: 100%;margin: 5px">添加库存信息</button>
            </div>
        </div>
    </div>
    <!-- /.container -->

</div>

<!-- 模态框（Modal） -->
<div class="modal fade" id="Remains_Update_Modal" tabindex="-1" role="dialog"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    注意！
                </h4>
            </div>
            <div class="modal-body" id="modal_text">
                在这里添加一些文本
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">关闭
                </button>
                <button type="button" id="btn_submit" class="btn btn-primary">
                    提交更改
                </button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal -->
</div>

</body>
</html>
